#!/usr/bin/env ruby

# frozen_string_literal: true

require 'English'
require_relative '../lib/git'
require_relative '../lib/jira'

jira = Jira.new

puts 'Select issue to checkout'
issues = jira.get_project_issues(jira.project_prefix)

require 'tty-prompt'

prompt = TTY::Prompt.new

choices = issues.map do |issue|
  {
    name: "#{issue['key']} - #{issue['fields']['summary']}",
    value: { key: issue['key'], summary: issue['fields']['summary'] }
  }
end

selected_issue = prompt.select('Choose issue:', choices, filter: true, per_page: 10)

Git.checkout_to_branch(selected_issue['key'], selected_issue['fields']['summary'])

puts 'Branch created and checked out'
